<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ac.ict.mapper.SysMenuMapper">

    <sql id="Base_Column_List">
        id,parent_id,parent_ids,name,url,icon,sort,status,permission,remark,
        create_time,create_id,update_id,update_time,type,open
    </sql>

    <select id="listMenuByUserId" resultType="cn.ac.ict.entity.SysMenuEntity">
		SELECT sm.id,sm.parent_id,sm.parent_ids,sm.name,sm.url,sm.icon,sm.sort,sm.status,sm.permission,sm.remark,sm.create_id,sm.create_time,sm.update_id,sm.update_time,sm.type,sm.open,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=sm.parent_id ) AS parentName
        FROM sys_user su INNER JOIN sys_user_role sur ON su.id=sur.user_id
        INNER JOIN sys_role sr ON sur.role_id=sr.id
        INNER JOIN sys_role_menu srm ON sr.id=srm.role_id
        INNER JOIN sys_menu sm ON srm.menu_id=sm.id
        WHERE su.id=#{userId} AND sr.status='0'
        ORDER BY sm.sort;
	</select>

    <select id="listMenuByLoginUser" resultType="cn.ac.ict.dto.SysMenuDTO">
        SELECT DISTINCT m.*,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=m.parent_id ) AS parentName
        FROM sys_user_role ur INNER JOIN sys_role r ON ur.role_id=r.id
        INNER JOIN sys_role_menu rm ON r.id=rm.role_id
        INNER JOIN sys_menu m ON m.id=rm.menu_id
        WHERE 1=1 AND r.status = '0'
        <if test="userId != 0">
            AND ur.user_id= #{userId}
        </if>
        ORDER BY sort
    </select>

    <select id="listMenuByParentId" resultType="cn.ac.ict.dto.SysMenuDTO">
        SELECT<include refid="Base_Column_List"/>,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=m.parent_id ) AS parentName
        FROM sys_menu m
        WHERE parent_id = #{parentId}
        ORDER BY sort
    </select>

</mapper>